<wxs src="../../utils/filter.wxs" module="filter" />

<scroll-view scroll-y type="list" class="scrollable">
	<block wx:if="{{loading}}">
		<view style="width: 100%; height: 100%;" class="center">
			<t-loading indicator="{{false}}" text="加载中..." />
		</view>
	</block>

	<block wx:else>
		<view class="banner" bind:tap="chooseCover">
			<image class="cover" mode="aspectFill" src="{{Activity.CoverUrls.Items[0]}}" />
		</view>

		<view class="sheet">
			<view class="content-wrap active">
				<view class="title">
					<text>{{Activity.Title}}</text>
					<block wx:if="{{Activity.SelfActivitySignUp}}">
						<text class="tag--sign-up">已上车</text>
					</block>
				</view>

				<view class="activity-addr row">
					<t-icon
					 style="margin-right: 4px;"
					 name="location-1"
					 size="16"
					 color="rgba(0, 0, 0, 0.55)"
					/>
					<text class="ellipsis" space="ensp" bind:tap="openLocation">{{Activity.Location.Name}} {{filter.distance(distance)}}</text>
				</view>

				<view class="activity-date row" style="margin-top: 8px;">
					<t-icon
					 style="margin-right: 4px;"
					 name="time"
					 size="16"
					 color="rgba(0, 0, 0, 0.55)"
					/>
					<text class="ellipsis" space="ensp">{{beginTime}}</text>
				</view>

				<view class="sub-title">小队成员</view>
				<view wx:if="{{ActivityMembers.length}}" style="margin-left: 24px;">
					<member-list members="{{ActivityMembers}}" />
				</view>

				<view class="sub-title">活动描述</view>
				<view class="activity-content">
					<text>{{Activity.Content}}</text>
				</view>

				<view class="sub-title">活动配图</view>
				<view>
					<block wx:for="{{Activity.PicList.Items}}" wx:for-item="url" wx:key="*this">
						<t-image
						 class="illustration"
						 error="slot"
						 loading="slot"
						 mode="widthFix"
						 src="{{url}}"
						 lazy
						>
							<t-loading slot="loading" indicator="{{false}}" text="加载中..." />
							<text class="error-text" slot="error">加载失败</text>
						</t-image>
					</block>
				</view>

			</view>
			<view class="avatar-wrap column-cross-center">
				<image class="avatar circle" src="{{Activity.Club.ClubIcon}}" />
				<text class="club-name" style="margin-top: 8px;">{{Activity.Club.ClubName}}</text>
			</view>
		</view>
	</block>
</scroll-view>

<block wx:if="{{!loading}}">
	<view wx:if="{{mode === 'audit'}}" class="tool-bar center">
		<view
		 class="btn row"
		 style="margin-right: 24px;"
		 data-status="AuditFail"
		 bind:tap="audit"
		>
			<t-icon
			 wx:if="{{auditResult === 'AuditFail'}}"
			 name="close"
			 size="20"
			 color="#4321F5"
			 style="margin-right: 6px;"
			/>
			<text>不通过</text>
		</view>
		<view class="btn active row" data-status="AuditSucc" bind:tap="audit">
			<t-icon
			 wx:if="{{auditResult === 'AuditSucc'}}"
			 name="check"
			 size="20"
			 color="#AFF164"
			 style="margin-right: 6px;"
			/>
			<text>通过</text>
		</view>
	</view>

	<view wx:else class="tool-bar row-between">
		<view class="row">
			<button open-type="share" class="btn--share" bind:tap="share">
				<view class="column-cross-center">
					<image class="icon" src="../../assets/images/@icon_share.svg" />
					<text style="margin-top: 2px;">邀请好友</text>
				</view>
			</button>
			<view class="column-cross-center" style="margin-left: 14px;" bind:tap="sharePoster">
				<image class="icon" src="../../assets/images/@icon_qrcode.svg" />
				<text style="margin-top: 2px;">保存二维码</text>
			</view>
		</view>
		<block wx:if="{{User.UserId == OwnerUserId}}">
			<view class="btn active">管理</view>
		</block>
		<block wx:elif="{{Activity.SelfActivitySignUp}}">
			<navigator
			 url="../customer-service/index"
			 hover-class="none"
			 class="btn active column-cross-center"
			 style="padding: 4px 24px;"
			>
				<text>联系客服</text>
				<text style="font-size: 12px; color: rgba(175, 241, 100, 0.70); opacity: 0.7;">参加报名活动群</text>
			</navigator>
		</block>
		<block wx:else>
			<view wx:if="{{Activity.ActivityRule.MaxSignUpNumber === Activity.SignUpNum}}" class="btn">活动已报满</view>
			<view wx:else bind:tap="goSignUp" class="btn active">¥{{filter.money(Activity.ActivityRule.Price)}} 走起</view>
		</block>
	</view>
</block>

<t-navbar wx:if="{{firstPage}}" fixed t-class="navbar">
	<view slot="capsule" class="custom-capsule">
		<t-icon
		 size="20"
		 bind:tap="onBack"
		 aria-role="button"
		 aria-label="返回"
		 name="chevron-left"
		 class="custom-capsule__icon"
		/>
		<t-icon
		 size="20"
		 bind:tap="onGoHome"
		 aria-role="button"
		 aria-label="首页"
		 name="home"
		 class="custom-capsule__icon"
		/>
	</view>
</t-navbar>

<t-navbar
 wx:else
 left-arrow
 fixed
 t-class="navbar"
/>

